<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sohbet</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.1/socket.io.min.js" integrity="sha512-wZ6EdN8gR/KL/9Hd13kqJxHDDY/x2goREVK9q0h6Na/N2Pp1HTSru8/4X1FfRTqp5TAw+jA2EodvKHmhIq5xqg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
<div class="chat-container">
  <h2>Hoşgeldin, {{ nickname }} {% if is_admin %}(Admin){% endif %}</h2>
  <div id="messages">
    {% for msg in messages %}
      <div><strong>{{ msg.nickname }}:</strong> {{ msg.text }}</div>
    {% endfor %}
  </div>
  <form id="messageForm">
    <input id="messageInput" autocomplete="off" placeholder="Mesajını yaz..." autofocus />
  </form>
</div>

<script>
  const socket = io();

  const messagesDiv = document.getElementById('messages');
  const input = document.getElementById('messageInput');
  const form = document.getElementById('messageForm');

  function addMessage(data) {
    const div = document.createElement('div');
    div.innerHTML = `<strong>${data.nickname}:</strong> ${data.text}`;
    messagesDiv.appendChild(div);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  }

  socket.on('receive_message', (data) => {
    addMessage(data);
  });

  socket.on('exit_chat', () => {
    window.location.href = '/';
  });

  form.addEventListener('submit', (e) => {
    e.preventDefault();
    const text = input.value.trim();
    if (text.length === 0) return;
    socket.emit('send_message', { text });
    input.value = '';
  });
</script>
</body>
</html>

